<!DOCTYPE html>
<html lang="en">
<head>
    <%-include('../../partials/header.ejs')%>
    <script src="/js/validaInputDataPeriodo.js" ></script>
</head>
<body  >
    
    <%-include('../../partials/navbar.ejs')%>

    <div class="conteudo" >

        <% if (user == '') { %>
            <!-- Menssagem do topo da página em jumbotron -->
            <div class="jumbotron jumbotron-fluid">
                <h1 class="display-4" >Cadastre-se para receber descontos!</h1>
                <p class="lead">Clientes cadastrados podem ver seu histórico de locações, gerenciar suas reservas e receber
                    descontos.</p>
            </div>
        <% } %>


        <div class="container" >
            <!-- <h3>Reboque escolhido</h3> -->
            
             <% if(user == '') {%>
            <form class="needs-validation" novalidate action="/reserva/cliente/formulario" method="POST">
            <% } else {%>
            <form class="needs-validation" novalidate action="/reserva/cliente/confirmar" method="POST">
            <% } %>
            
                <div class="lista-reboques">

                    <div class="card card-reserva" style="width: 25rem;">
                        <img src="../../../<%=reboque.foto%>" class="card-img-top" alt="...">
                        <div class="card-body">
                        <h5 class="card-title"> Tipo: <%=reboque.modelo%></h5>
                        <h5 class="card-text">Diária R$: <%=reboque.valorDiaria%>,00</h5>
                        <hr>
                        <h5 class="card-text"><%=reboque.descricao%></h5>
                        </div>
                    </div>

                    <div class="card card-reserva" style="width: 25rem;">
                        <div class="card-body">

                                <h5>Informe o periodo</h5>
                                <hr>

                                <% if(mensagem){%>
                                    <div class="alert alert-danger">
                                        <strong>Atenção!</strong>
                                        <%= mensagem %>
                                    </div>
                                <% } %>
                                
                                <div class="input-group mb-3 mt-5">
                                    <span class="input-group-text" >Data Retirada</span>
                                    <input class="form-control" id="dataInicio" type="date" name="dataInicio" required>
                                    <div class="valid-feedback">
                                        <!-- Looks good! -->
                                    </div>
                                    <div class="invalid-feedback">
                                        Verifique a data.
                                    </div>
                                
                                </div>



                                <div class="input-group">
                                    <span class="input-group-text">Hora Retirada</span>
                                    <select class="form-select" id="horaInicio" name="horaInicio" required>
                                      <!-- Gera opções de 00 a 23 -->
                                      <% for(let i = 8; i < 20; i++) { %>
                                        <option value="<%= i %>"><%= i.toString().padStart(2, '0')+':00' %></option>
                                      <% } %>
                                    </select>
                                    <div class="valid-feedback">
                                        <!-- Looks good! -->
                                    </div>
                                    <div class="invalid-feedback">
                                        <span id="invalidHoraInicio" ></span>
                                    </div>
                                </div><br>
                                  

                        


                                <div class="input-group mb-3">
                                    <span class="input-group-text" >Data Entrega</span>
                                    <input class="form-control" id="dataFim" type="date" name="dataFim" required>
                                    <div class="valid-feedback">
                                        <!-- Looks good! -->
                                    </div>
                                    <div class="invalid-feedback">
                                        Verifique a data.
                                    </div>
                                </div>

                                <div class="input-group mb-3">
                                    <span class="input-group-text">Hora Entrega</span>
                                    <select class="form-select" id="horaFim" name="horaFim" required>
                                      <!-- Gera opções de 00 a 23 -->
                                      <% for(let i = 8; i < 20; i++) { %>
                                        <option value="<%= i %>"><%= i.toString().padStart(2, '0')+':00' %></option>
                                      <% } %>
                                    </select>
                                    <div class="valid-feedback">
                                        <!-- Looks good! -->
                                    </div>
                                    <div class="invalid-feedback">
                                        <span id="invalidHoraFim" ></span>
                                    </div>
                                </div><br>

                                

                                
                                <% if(user != ''){ %>
                                <div class="form-check input-group">
                                    <input class="form-check-input" type="radio" name="formaPagamento" id="formaPagamento" value="PIX" checked>
                                    Pagar com PIX
                                </div>
                                <br>
                                <div class="form-check input-group">
                                    <input class="form-check-input" type="radio" name="formaPagamento" id="formaPagamento" value="DINHEIRO">
                                    Pagar com Dinheiro
                                </div>
                                <% } %>
                                
                                
                            

                        </div>

    
                        <div class="d-flex justify-content-center" style="margin: 0.5rem;">
                            <button class="btn btn-secondary me-3" type="button" onclick="history.back()">Voltar</button>
                            <input class="btn btn-primary" id="botao" type="submit" value="Próximo">
                        </div>

                    </div>


                    <% if(reservas != '') {%>
                        <div class="card card-reserva" style="width: 25rem;">
                            <div class="card-body">

                                <h5 class="card-text">Reservas deste reboque</h5>

                                <hr>

                                <div class="table-responsive">
                                    <table class="table table-striped">
                                        <thead>
                                            <tr>
                                                <th>Início/Hora</th>
                                                <th>Fim/Hora</th>
                                                <th>Situação</th>
                                            </tr>
                                        </thead>
                                        <tbody>

                                            <% reservas.forEach(function(reserva) { %>
                                                <tr>
                                                    <td><%= new Date(reserva.dataSaida).toLocaleDateString('pt-BR').slice(0, 5) %> 
                                                        <%= new Date(reserva.dataSaida).toString().slice(16,21) %></td>
                                                    <td><%= new Date(reserva.dataChegada).toLocaleDateString('pt-BR').slice(0, 5) %>
                                                        <%= new Date(reserva.dataChegada).toString().slice(16,21) %></td>
                                                    <td><%= reserva.situacaoReserva.slice(0, 10)%></td>

                                                </tr>
                                            <%})%>
                                        </tbody>
                                    </table>
                                </div>

    
                            </div>
                        </div>
                    <% } %>

                </div>
                <input type="hidden" name="reboquePlaca" value="<%=reboque.placa%>" >
            </form>
        </div>
    </div>
    <%-include('../../partials/footer.ejs')%>
</body>
</html>