<!DOCTYPE html>
<html lang="en">
<head>
    <%-include('../../partials/header.ejs')%>
</head>
<body>
  <%-include('../../partials/navbaradmin.ejs')%>
  <div class="conteudo" >

    <div class="container" >

      <div class="d-flex justify-content-start">
        <h3 class="display-4">Lista de Reservas</h3>
      </div>
      
        
      <!-- <div class="container"> -->
      <div class="row">
        <% reservas.forEach(function (reserva, i) { %>
        <div class="col-md-6 col-lg-4 mb-4">
          <div class="card card-cliente h-100">
            <div class="card-body">

              <!-- Cabeçalho do Card (clicável) -->
              <div class="card-header bg-white d-flex justify-content-between align-items-center"
                data-bs-toggle="collapse" data-bs-target="#detalhesReserva<%=i%>"
                style="cursor:pointer;">
                <div>
                  <h6 class="mb-1 fw-bold text-primary"><i class="fas fa-user"></i> <%=reserva.cliente.nome%></h6>
                  <small class="text-muted">
                    <i class="fas fa-calendar-alt"></i> 
                    <%=new Date(reserva.dataSaida).toLocaleDateString('pt-BR')%> → 
                    <%=new Date(reserva.dataChegada).toLocaleDateString('pt-BR')%>
                  </small>
                </div>
                <span class="fw-bold text-success fs-6">
                  R$ <%=reserva.pagamento.valor%>,00
                </span>
              </div>

              <!-- Corpo colapsável -->
              <div id="detalhesReserva<%=i%>" class="collapse">
                <div class="card-body p-3">

                  <!-- Cliente -->
                  <p class="mb-1 text-muted"><i class="fas fa-id-card"></i> CPF: <%=reserva.cliente.cpf%></p>
                  <p class="mb-1 text-muted"><i class="fas fa-phone"></i> <%=reserva.cliente.telefone%></p>

                  <!-- Endereço -->
                  <hr>
                  <p class="mb-1"><i class="fas fa-map-marker-alt"></i> 
                    <%=reserva.cliente.logradouro%>, <%=reserva.cliente.numero_da_casa%>
                  </p>
                  <p class="mb-1 text-muted"><%=reserva.cliente.localidade%></p>

                  <!-- Período -->
                  <hr>
                  <p class="mb-1"><i class="fas fa-calendar-day text-success"></i> 
                    Início: <%=new Date(reserva.dataSaida).toLocaleDateString('pt-BR')%> 
                    <small class="text-muted"><%=new Date(reserva.dataSaida).toString().slice(16,21)+'h'%></small>
                  </p>
                  <p class="mb-1"><i class="fas fa-calendar-check text-danger"></i> 
                    Fim: <%=new Date(reserva.dataChegada).toLocaleDateString('pt-BR')%> 
                    <small class="text-muted"><%=new Date(reserva.dataChegada).toString().slice(16,21)+'h'%></small>
                  </p>

                  <!-- Reboque -->
                  <hr>
                  <p class="mb-1"><i class="fas fa-trailer"></i> Placa: <strong><%=reserva.reboque.placa%></strong></p>
                  <p class="mb-1"><i class="fas fa-dollar-sign"></i> Diária: R$ <%=reserva.reboque.valorDiaria%>,00</p>
                  <p class="mb-1"><i class="fas fa-clock"></i> Dias: <%=reserva.diarias%></p>
                </div>
              </div>

              <!-- Rodapé com ação -->
              <div class="card-footer bg-light d-flex justify-content-end">
                <a href="/reserva/admin/excluir/<%=reserva.id%>" 
                  class="btn btn-sm btn-outline-danger"
                  onclick="return confirm('Confirma a exclusão?')">
                  <i class="fas fa-trash"></i> Excluir
                </a>
              </div>

            </div>

          </div>
        </div>
        <% }) %>
      </div>

      <%
        const maxPaginasVisiveis = 2; // quantas antes/depois da atual
        const inicio = Math.max(1, paginaAtual - maxPaginasVisiveis);
        const fim = Math.min(totalPaginas, paginaAtual + maxPaginasVisiveis);
      %>

      <div class="d-flex justify-content-center mt-4">
        <ul class="pagination flex-wrap justify-content-center">

          <!-- Anterior -->
          <li class="page-item <%= paginaAtual === 1 ? 'disabled' : '' %>">
            <a class="page-link" href="?page=<%= paginaAtual - 1 %>"><</a>
          </li>

          <!-- Primeira página -->
          <% if (inicio > 1) { %>
            <li class="page-item">
              <a class="page-link" href="?page=1">1</a>
            </li>

            <% if (inicio > 2) { %>
              <li class="page-item disabled">
                <span class="page-link">...</span>
              </li>
            <% } %>
          <% } %>

          <!-- Páginas centrais -->
          <% for (let i = inicio; i <= fim; i++) { %>
            <li class="page-item <%= i === paginaAtual ? 'active' : '' %>">
              <a class="page-link" href="?page=<%= i %>"><%= i %></a>
            </li>
          <% } %>

          <!-- Última página -->
          <% if (fim < totalPaginas) { %>
            <% if (fim < totalPaginas - 1) { %>
              <li class="page-item disabled">
                <span class="page-link">...</span>
              </li>
            <% } %>

            <li class="page-item">
              <a class="page-link" href="?page=<%= totalPaginas %>">
                <%= totalPaginas %>
              </a>
            </li>
          <% } %>

          <!-- Próximo -->
          <li class="page-item <%= paginaAtual === totalPaginas ? 'disabled' : '' %>">
            <a class="page-link" href="?page=<%= paginaAtual + 1 %>">></a>
          </li>

        </ul>
      </div>

      
    </div>
  </div>

  <%-include('../../partials/footer'); %>

</body>
</html>